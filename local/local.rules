# https://github.com/reuteras/suricata-rules 
# From: https://www.zscaler.com/blogs/security-research/catching-rats-over-custom-protocols
# Converted with snort2suricata
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"Zscaler Win32.Backdoor.CrimsonRat - CNC command"; flow:established,to_client; content:"|00 00 00 00|"; offset:1; depth:4; pcre:"/\x00\x00\x00\x00(thumb|filsz|rupth|dowf|endpo|scrsz|cscreen|dirs|stops|scren|cnls|udlt|delt|afile|listf|file|info|runf|fles|dowr|info|fldr)+=/"; classtype:trojan-activity; reference:url,https://research.zscaler.com; sid:0; rev:0;)
<nil>
<nil>
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"Zscaler Win32.Backdoor.AsyncRAT - Malicious SSL Cert"; flow:established,to_client; content:"|16 03 01|"; offset:0; depth:3; content:"AsyncRAT"; distance:0; fast_pattern; classtype:trojan-activity; reference:url,https://research.zscaler.com; sid:0; rev:0;)
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"Zscaler Win32.Backdoor.QuasarRAT - CNC response header"; flow:established,to_client; dsize:68; content:"@|00 00 00|"; offset:0; depth:4; classtype:trojan-activity; reference:url,https://research.zscaler.com; sid:0; rev:0;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"Zscaler Win32.Backdoor.AgentTesla CNC via FTP/SMTP"; flow:established,to_server; content:"<html>Time|3A|"; content:"<br>User Name|3A|"; content:"<br>Computer Name|3A|"; distance:0; content:"<br>OSFullName|3A|"; distance:0; content:"CPU|3A|"; distance:0; content:"<br>RAM|3A|"; distance:0; content:"URL|3A|"; distance:0; content:"Application|3A|"; distance:0; classtype:trojan-activity; reference:url,https://research.zscaler.com; sid:0; rev:0;)
alert tcp $HOME_NET any -> any any (msg:"Zscaler Win32.Backdoor.CyberGate - Data Exfiltration"; flow:established,to_server; dsize:40<>300; pcre:"/\d{2,3}[#$]{4,6}\x0d\x0a/"; content:"##$##|0D 0A|"; classtype:trojan-activity; reference:url,https://research.zscaler.com; sid:0; rev:0;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"Zscaler Win32.Backdoor.Nanocore Pulse check"; flow:established,to_server; dsize:12; content:"|08 00 00 00|"; offset:0; depth:4; content:"/c1 c3 d0 32  43 59 a1 78|7C|"; distance:0; within:8; classtype:trojan-activity; reference:url,https://research.zscaler.com; sid:0; rev:0;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"Zscaler Win32.Backdoor.Nanocore - Generic C&C command (request)"; flow:established,to_server; dsize:12; content:"|08 00 00 00|"; offset:0; depth:4; byte_test:1,!=,0,5,relative; flowbits:isset,ZS.NanocoreGen; reference:url,https://zscaler.com; sid:0; rev:0;)
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"Zscaler Win32.Backdoor.Nanocore - Generic C&C command (response)"; flow:established,to_client; content:" |00 00 00|"; offset:0; depth:4; byte_test:1,!=,0,5,relative; dsize:36; flowbits:noalert; flowbits:set,ZS.NanocoreGen; reference:url,https://zscaler.com; sid:0; rev:0;)
alert tcp any any -> any any (msg:"Zscaler Win32.Backdoor.Gh0stRAT - Possible Data Exfil activity"; flow:to_server,established; byte_extract:1,10,varbyte; byte_test:1,!=,varbyte,11; byte_test:1,=,varbyte,12; byte_test:1,=,varbyte,13; byte_test:1,!=,varbyte,15; byte_extract:4,16,vardword; byte_test:4,=,vardword,20; byte_test:4,=,vardword,24; byte_test:4,=,vardword,28; byte_test:4,!=,vardword,0; classtype:trojan-activity; reference:url,https://research.zscaler.com; sid:8000031; rev:0;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"Zscaler Win32.Backdoor.NjRat - Data Exfil activity"; flow:to_server,established; content:"|00|inf"; offset:3; depth:4; pcre:"/\d{1,3}\x00\w{1,3}/"; pcre:"/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/"; classtype:trojan-activity; flowbits:isset,ZS.njrat; flowbits:unset,ZS.njrat; reference:url,https://research.zscaler.com; sid:0; rev:0;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"Zscaler Win32.Backdoor.NjRat - Data Exfil activity"; flow:to_server,established; content:"|00|ll"; offset:3; depth:3; pcre:"/^\d{1,3}\x00/"; pcre:"/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/"; classtype:trojan-activity; flowbits:set,ZS.njrat; flowbits:noalert; reference:url,https://research.zscaler.com; sid:0; rev:0;)
